##### Свёртка
![[Lect3 - CV2 - Свёрточные сети-1758190184454.jpeg]]
- Пиксель в результирующем изображении зависит только от небольшого участка исходного изображения (local connectivity)
- Веса одни и те же для всех пикселей результирующего изображения (shared weights)

Обычно исходное изображение цветное => в нем несколько каналов (RGB)
Учтём в формуле:
![[Lect3 - CV2 - Свёрточные сети-1758190428099.jpeg]]

![[Lect3 - CV2 - Свёрточные сети-1758190496884.jpeg]]


![[Lect3 - CV2 - Свёрточные сети-1758191116361.jpeg]]
- Обучается только фильтр
- Количество параметров: $$((2d+1)^2 * C + 1) * T$$
- Как из этого сделать модель?

##### Receptive field

- Возьмем пиксель в итоговом изображении (после сверточных слоёв)
- От какой части входного изображения зависит значение в этом пикселе?

![[Lect3 - CV2 - Свёрточные сети-1758191275270.jpeg]]

![[Lect3 - CV2 - Свёрточные сети-1758191326417.jpeg]]

Поле восприятия для свертки 3х3:
- После 1 сверточного слоя: 3х3
- После 2 сверточных слоев: 5х5
- После 3 сверточных слоев: 7х7

Давайте попробуем фильтр 5х5:

![[Lect3 - CV2 - Свёрточные сети-1758191466039.jpeg]]

Все равно медленно!

##### Свёртки с пропусками (strides)

![[Lect3 - CV2 - Свёрточные сети-1758191523711.jpeg]]

![[Lect3 - CV2 - Свёрточные сети-1758191602990.jpeg]]

##### Dilated convolutions ("Раздутые свёртки")

![[Lect3 - CV2 - Свёрточные сети-1758191953356.jpeg]]

![[Lect3 - CV2 - Свёрточные сети-1758192014501.jpeg]]

##### Pooling
- операция без параметров, которая устроена так: берем нарезаем кусочки 2х2 и из каждого кусочка 2х2 берем максимум/среднее/min

![[Lect3 - CV2 - Свёрточные сети-1758192045544.jpeg]]

Зачем это все? 
- Важно следить за тем, чтобы последние сверточные слои имели размер поля восприятия, сравнимый со всей картинкой

##### Padding

- Если применять свертку по формуле, то выходное изображение меньше, чем исходное

Мы можем добить край картинки нулями, тогда все будет хорошо

![[Lect3 - CV2 - Свёрточные сети-1758192249303.jpeg]]

А может быть можно заполнять не только нулями?

**Valid mode**
- При честном подсчёте свёрток пиксели на краях не оказывают большого влияния на результат

![[Lect3 - CV2 - Свёрточные сети-1758192328048.jpeg]]
![[Lect3 - CV2 - Свёрточные сети-1758192402419.jpeg]]

> это Zero padding

- Добавляем по границам нули так, чтобы посчитанным

**Reflection Padding**

![[Lect3 - CV2 - Свёрточные сети-1758192540557.jpeg]]

**Replication padding**

Резюме:
- Паддинг позволяет контролировать размер выходных...

### Архитектуры сверточных слоёв

Типичная архитектура:
![[Lect3 - CV2 - Свёрточные сети-1758192655613.jpeg]]

Самая первая (98) - LeNet
![[Lect3 - CV2 - Свёрточные сети-1758192760136.jpeg]]

AlexNet
![[Lect3 - CV2 - Свёрточные сети-1758192769527.jpeg]]

Представления с последних слоёв
- Важное наблюдение: выходы полносвязных слоёв являются хорошими признаковыми описаниями изображений
- Полезны во многих задачах
- Например, поиск похожих изображений

Представления с последних слоёв

1 слой
![[Lect3 - CV2 - Свёрточные сети-1758192829658.jpeg]]

2 слой
![[Lect3 - CV2 - Свёрточные сети-1758192899299.jpeg]]

3 слой
![[Lect3 - CV2 - Свёрточные сети-1758192949039.jpeg]]

5 слой
![[Lect3 - CV2 - Свёрточные сети-1758192970521.jpeg]]

Вектор признаков перед последним слоем оказался очень полезным. Можно просто смотреть на него даже без предобработки

![[Lect3 - CN2 - Свёрточные сети-1758193063283.jpeg]]

### Оптимизация

SGD, Mini-batch GD, 

А какой размер батча брать?
![[Lect3 - CN2 - Свёрточные сети-1758193727934.jpeg]]

Оказывается, нужно грамотно подбирать длинну шага

##### Модификации GD

Проблемы:
- Из-за перпендикулярности антиградиента линиям уровня, появляется асцелляция
- Если у функции "вытянуты" линии уровня, то градиентный спуск требует аккуратного выбора длинны шага
А что, если мы сложим шаги?
![[Lect3 - CN2 - Свёрточные сети-1758193983277.jpeg]]
Тогда будем шагать по сумме антиградиентов - метод Momentum

![[Lect3 - CN2 - Свёрточные сети-1758194014498.jpeg]]

Доп переменная h_t

Беру h_(t-1), умножаю на \alpha и прибавляю градиент текущего шага

Без инерции:
![[Lect3 - CN2 - Свёрточные сети-1758194114866.jpeg]]

С инерцией:
![[Lect3 - CN2 - Свёрточные сети-1758194137173.jpeg]]

##### Nesterov Momentum

В обычном моментуме:
![[Lect3 - CN2 - Свёрточные сети-1758194192466.jpeg|333x186]]

в моментуме нестерова:
![[Lect3 - CN2 - Свёрточные сети-1758194304548.jpeg]]

