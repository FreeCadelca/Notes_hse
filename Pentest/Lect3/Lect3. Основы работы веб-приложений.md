![[Materials/Pasted image 20250913111723.jpeg]]

### Клиент и сервер

Клиент-серверная архитектура
Клиент: потребитель информации
- Веб-браузер
- Консольное приложение
- ПО
- др
Сервер:
- производитель информации

Какой минимальный набор нужен для сайта? - веб сервер и статический контент

### Приложение, веб сервер и веб-сайт

Различия:

![[Lect3. Основы работы веб-приложений-1757944790102.jpeg]]

Веб-сайт может быть статическим (страничка), веб-приложение обязательно с поваром

Веб-приложение без статического контента - API или генерирует статический контент на лету

Веб-сервера:
- nginx
- apache
- microsoft iis
- caddy
- tomcat
- Guicorn / uWSGI
- ...

Популярные связки:
- Nginx + py (Django/Flask/FastApi)
- Nginx + Node.js (express/nest js)
- Apache + php (WordPress/Laravel)
- IIS + C# (ASP.NET Core)
- Tomcat + Java (Spring Boot)
- Caddy + Go (Gin/Echo)

### HTTP

- Протокол прикладного уровня
- Работает по принципу запрос-ответ
- Бывает шифрованным (https) и нет (http)
- Имеет разные версии
![[Lect3. Основы работы веб-приложений-1757945077259.jpeg]]

Минимальный запрос:
```
GET/HTTP/1.1
Host: example.com


```
Метод - GET
Путь - /
Версия - HTTP/1.1
Хост - example.com
два переноса строки

Минимальный ответ:
```
HTTP/1.1 200 OK
```
Версия - HTTP/1.1
Код ответа - 200 OK

##### Коды ответа

XYY
x - класс кода ответа
yy - номер в классе

1. 1xx - информационные
	- 100 - continue
	- 101 - switching protocols
2. 2xx - коды успеха
	- 200 - ok
	- 201 - created
3. 3xx - перенаправления
	- 301 - moved permanently
	- 302 - found
4. 4xx - ошибки на стороне клиента
	- 401 - unautorized 
	- 403 - forbidden
5. 5xx - ошибки на стороне сервера
	- 500 - internal server error
	- 504 - gateway timeout

> Метод запроса - определяет тип производимого действия

##### Методы http запросов:

![[Materials/Pasted image 20250913112901.jpeg|581x231]]

> Идемпотентный метод - если ввели несколько раз, то результат не изменится

GET ==/personal/profile.php== HTTP/1.1
Путь - позволяет серверу понять, какой именно фрагмент кода приложения требуется запустить (http routing)

##### HTTP Routing types:

- **File system Routing**
	1. Фиксируется web root веб-сервера (/var/www/html)
	2. Файлы приложения помещаются физически на файловую систему (/var/www/html/profile.php)
	3. При обращении по пути происходит адресация к конкретному файлу (/profile.php -> /var/www/html/profile.php)
- **Annotation-Based Routing (Decorator routing)**
	- Пути декларируются в декораторах соответствующих классов/функций
![[Materials/Pasted image 20250913113402.jpeg]]
- **Code-based/Imperative Routing**
	- Пути декларируются напрямую в коде
![[Materials/Pasted image 20250913113514.jpeg]]
- Servlet mappings (java servlet api)
	- Имеется специальный xml-файл, который определяет соответствие путей обработчикам (Servlet)
![[Materials/Pasted image 20250913113504.jpeg]]
- Configuration-File Routing
	- Имеется файл-конфигурация, определяющая соответствие пути и класса/функции
![[Materials/Pasted image 20250913113621.jpeg]]
- Convention-Based Routing
	- Пути наследуются исходя из названий (/users/show/:id запустит метод show класса UsersController)

##### Версия

> Версия - определяет формат, в котором были отправлены данные

Http/0.9
- Совсем древний, только get метод
- Нет заголовков
- **Проблема: слишком примитивный**

http/1.0
- Древний, но где-то встречается
- Методы head, post
- Заголовки
- Типы контента
- Коды состояния 
- **Проблема: всего одно соединение на объект**

Http/1.1
- Старый, но доминирует
- Появилась возможность не обрывать запрос
- Обязательный заголовок host
- Появилось кеширование, сжатие, чанкование
- Новые коды состояния
- Методы PUT, DELETE, TRACE
- **Проблема: головная блокировка (Head-of-Line Blocking - HOL), медленный ответ на первый запрос в конвейере, блокирует все последующие в очереди**

HTTP/2
- Широко используется, но пока не победил 1.1
- Бинарный протокол
- Мультиплексирование (параллельная отправка запросов в рамках одного tcp-тунеля)
- Приоритизация запросов (js > картинки)
- Сжатие заголовков
- Возможность отправить объекты до того, как их запросили
- **Проблема: HOL на уровень ниже, если один tcp-пакет потеряется, весь поток заблокируется**

HTTP/3
- Активно внедряется
- Использует QUIC вместо TCP
- Встроенное шифрование
- Очень быстрый
- Умеет быстро переключаться между сетями
- **Проблема: требует поддержки и на уровне клиента, и на уровне сервера**

**Параметры** - позволяют передать что-то серверу
Способы передачи параметров:
1. GET запрос
	```
	GET /personal/profile.php?user=hacker&theme=dark HTTP/1.1
	Host: example.com
	```
2. GET-запрос RESTful-сервиса
	```
	GET /personal/profile.php/hacker/dark HTTP/1.1
	Host: example.com
	```
3. POST-запрос - после заголовков через отступ:
	```
	POST /personal/profile.php? HTTP/1.1
	Host: example.com
	Content-Type: application/x-www-form-urlencoded
	Content-Length: 22
	
	user=hacker&theme=dark
	```

##### Заголовки
передают спец информацию (метаданные)

### Ключевые заголовки
- cookies
	- имеют меньший размер (~4кб)
	- автоматически отправляются при каждом запросе
	- доступны из JS, но это можно ограничить флагами безопасности
	- имеют 3 флага безопасности: httpOnly, Secure, SameSite
	- время жизни регулируется
	- отправляются заголовком Cookie:
- LocalStoarge
	- имеют больший размер (5-10мб)
	- никогда не отправляются автоматически
	- всегда доступны из Js
	- нет лимита времени жизни
	- отправляются заголовком Autorization
- SessionStoarge
	- то же самое, что LocalStoarge, но активна, пока открыта вкладка браузера (лимит жизни)
Хранятся в Application -> Stoarge -> \<stoarges\>

Прочие важные заголовки:
- **Host** - указывает доменное имя и порт сервера 
	`Host: example.com` 
- **Content-Type** - указывает MIME-тип тела запроса 
	`Content-Type: application/json`
- **Content-Length** - Указывает размер тела HTTP-сообщения в **байтах** 
	`Content-Length: 1337`
- **Refer** - указывает URL предыдущей страницы 
	`Referer: https://example.com/some_path`
- **Origin** - указывает origin источника запроса (для CORS) 
	`Origin: https://example.com`
- **User-Agent** - Идентифицирует клиентское ПО (браузер, ОС) 
	`User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...`
- **X-Forwarded-For (XFF)** - Используется прокси для указания реального IP клиента
	`X-Forwarded-For: 192.168.1.1`
- **Transfer-Encoding** - Используется для указания формата отправки тела запроса
	`Transfer-Encoding: chunked`
- **Location** - Заголовок ответа. Указывает URL для перенаправления (в ответах 3xx)
	`Location: https://example.co)`
- **Content-Security-Policy (CSP)** - Заголовок ответа. Регулирует правила загрузки скриптов, фреймов, прочего контента (Content-Security-Policy: default-src 'self';)
	`Content-Security-Policy: default-src 'self';`

### Прокси-сервер

![[Materials/Pasted image 20250913115343.jpeg]]

Первоначально мы можем делать запрос к прокси-серверу, потом он перенаправляет нас на виртуальные хосты

![[../Lect2/Materials/Pasted image 20250913102301.jpeg]]

Также используется как балансировщик нагрузки

![[Materials/Pasted image 20250913115502.jpeg]]

Терминация SSL/TLS

![[Materials/Pasted image 20250913115700.jpeg]]

Кеширование
![[Materials/Pasted image 20250913115751.jpeg]]

Frontend и Backend сервера
![[Materials/Pasted image 20250913115903.jpeg]]

Frontend сервер может генерировать статический контент  

http downgrade - переход на более низкую версию (всегда создает проблемы, но иногда используется)

### Архитектуры веб-приложений

**Монолит**

![[Materials/Pasted image 20250913120057.jpeg]]

"Большое, неподъемное", все начинающие сервисы начинаются с монолита, только потом он распиливается

В банках постоянно используется монолит, уйти от него тяжело.

**Микросервисная архитектура**

![[Materials/Pasted image 20250913120242.jpeg]]

**Сервис-ориентированная архитектура**

![[Materials/Pasted image 20250913120509.jpeg]]
похож на микросервис, но более выделенные сервисы

### Intercept Proxy

![[Materials/Pasted image 20250913120613.jpeg]]