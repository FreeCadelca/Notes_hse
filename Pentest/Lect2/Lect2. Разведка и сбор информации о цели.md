### Поиск TLD(+1)

> TLD - top level doman

Пример: www.example.com 
- поддомен: **www**
- домен второго уровня (TLD+1): **example**
- домен верхнего уровня (TLD): **com**

Утилита: **whois**

![[../Lect1/Materials/Pasted image 20250913100703.jpeg|649x390]]
`whois -H example.com` - информация по тому, кто зарегистрировал домен (организация), когда обновлен, url и т.д.

утилиты по доменам 1 уровня: 
- dnsrecon
	- `dnsrecon -t tld example.com`
	- большой риск FP
- crobat (старая)
	- `crobat -t example.com`
	- большой риск FP
- amass
	- `amass intel -whois -df tld.txt`

> **SSL (certificate transparency)** - проект, согласно которому CA обзаны публиковать информацию о каждом выпущенном сертификате.

Делаем поиск по выпущенным SSL сертификатам компании:
```
https://crt.sh/?o=organization+name
https://crt.sh/?q=example.com
https://crt.sh/?a=1
```

### Получение информации от NS

> DNS - domain name server

Основные виды записей:
- A: IPv4
- AAAA: IPv6
- CNAME: алиас на другой домен
- MX: доменное имя почтового сервера
- **NS: список серверов, ответственных за разрешение доменных имëн (Name Servers)**
- PTR: используется для обратной связи (IP -> доменное имя)
- TXT: текстовое поле

Zone Transfer
- Репликация DNS-записей с одного NS-сервера на другой
- Осуществляется при помощи AXFR запросов
- Если имеется миссконфигурация, выполнить данную операцию может кто угодно
- **ВАЖНО! Это шумная операция**
```
dig axfr @ns.server.domain target.domain
host -I target.domain ns.server.domain
dnsrecon -a -d "target.domain"
```

Reverse NS Lookup
- поиск доменов, использующих конкретный NS
- В некоторых случаях позволяет получить список поддоменов
```
https://viewdns.info/reversens/?ns=ns.server.domain
```

### Поиск поддоменов

##### Утилиты:

- zdns
- altdns
- dnsx
- shuffledns
- gobuster
- ffuf
- dnsrecon
	- `dnsrecon -d "target.domain"`
- crobat (устар)
	- `crobat -s example.com`
- amass 
	- `amass enum -passive -df tld.txt -config your.config`
	- `amass enum -passive -norecursive -noalts -df tld.txt -config your.config`

##### SSL:

- findomain
	- `findomain -t "target.domain" -a`
- subfinder
	- `subfinder -d "target.domain"`
- assetfinder
	- `assetfinder "target.domain"`

##### API

Можно использовать API Следующих сервисов:
```
AlienVault, BinaryEdge, BufferOver, BuiltWith, C99, Censys, Chaos, CIRCL, DNSDB, DNSTable, FacebookCT, GitHub, HackerOne, HackerTarget, NetworksDB, PassiveTotal, RapidDNS, Riddler, SecurityTrails, Shodan, SiteDossier, Spyse, Twitter, Umbrella, URLScan, VirusTotal, WhoisXML, ZETAlytics, Cloudflare
```
Имеется интеграция данных сервисов с amass с указанием API-ключа

##### Shodan

> Shodan - поисковая система, позволяющая пользователям искать различные типы серверов веб-камеры, с использованием различных фильтров. Некоторые также описывают её как поисковую систему сервисных баннеров, представляющие собой метаданные, которые сервер отправляет обратно клиенту. Этими метаданными могут быть информация о серверном программном обеспечении, какие опции поддерживает сервис, приветственное сообщение или что-то ещё, что клиент должен выяснить перед взаимодействием с сервером.

- [shodan]((https://www.shodan.io/)
	- `hostname:"target.domain"`
- [nrich](https://www.shodan.io/) = cli shodan
	- `echo 127.0.0.1 | nrich -`
	- `nrich ip_list.txt`
в некоторых случаях можно получить имеющиеся уязвимости

##### Sundomain brute-forcing

1. Получение списка резолверов (NS-серверов), также можно использовать собственные ns-сервера компании
	```
	wget https://raw.githubusercontent.com/wavvs/lazydns/master/resolvers.txt
	```
2. Получение списка потенциальных поддоменов
	```
	https://github.com/assetnote/commonspeak2-wordlists/blob/master/subdomains/subdomains.txt
	https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/dns-Jhaddix.txt
	https://github.com/wavvs/lazydns/blob/master/wordlists/normal.txt
	https://github.com/wavvs/lazydns/tree/master/wordlists/big.txt
	```
3. Запуск перебора (zdns)
	```
	zdns A --name-servers=@resolvers.txt -input-file wordlist.txt -threads 50 -retries 3 -go-processes 5 | tee result_A.json 
	zdns CNAME --name-servers=@resolvers.txt -input-file wordlist.txt -threads 50 -retries 3 -go-processes 5 | tee result_CNAME.json
	zdns AAAA --name-servers=@resolvers.txt -input-file wordlist.txt -threads 50 -retries 3 -go-processes 5 | tee result_AAAA.json
	```
4. Поиск изменённых доменных имён для обнаруженных доменов (altdns)
	```
	altdns -i resolved_domains.txt -w words.txt -o permutated.txt
	```
5. Разрешение (Resolve) доменных имён
	```
	zdns A --name-servers=@resolvers.txt -input-file permutated.txt -threads 50 -retries 3 -go-processes 5 | tee result_A.json
	zdns CNAME --name-servers=@resolvers.txt -input-file permutated.txt threads 50 -retries 3 -go-processes 5 | tee result_CNAME.json
	zdns AAAA --name-servers=@resolvers.txt -input-file permutated.txt threads 50 -retries 3 -go-processes 5 | tee result_AAAA.json
	```
Дополнительные утилиты:
```
dnsrecon -t brt -d "target.domain" -n "nameserver.com" -D "/path/to/wordlist"
gobuster dns --domain "target.domain" --resolver "nameserver" --wordlist "/path/to/wordlist"
```

##### Фильтрация

Wildcard domains - это dns-запись вида `*.example.com A 127.0.0.1`
nonexistantsubdomain.example.com----->-------\
anothernonexistantsubdomain.example.com-->--|
127.0.0.1 <------------------------------------------/

Быстрая проверка на wildcard domains через dig:
```
dig a 'nonexistentdomain0123456789.example.com'
dig a '*.example.com'
```
Замечания:
- в некоторых конфигах разрешен wildcard-домен, однако не будет ответа на запрос \*.example.com
- В некоторых конфигурациях будет исполь...

Проверка с помощью dnsx
```
dnsx -r resolvers.txt -l wordlist.txt -wd domain.to.filter.com -o output.txt
shuffledns -d domain.to.filter.com -list wordlist.txt -r resolvers.txt
```
Утилиты считают количество доменов, которые разрешаются в один и тот же IP-адрес
При преодолении лимита домены будут проверяться на wildcard

### Поиск виртуальных хостов
Vhost

![[../Lect1/Materials/Pasted image 20250913102301.jpeg]]

Утилиты:
- Burp 
- ffuf
	```
	ffuf -w /path/to/wordlist.txt -u https://target.domain -H "Host: FUZZ"
	ffuf -H "Host: FUZZ.target.domain" -c -w "/path/to/wordlist.txt" -u your_url
	ffuf -c -r -w "/path/to/wordlist.txt" -u «http://FUZZ.target.domain/"
	```
- wfuxx 
	```
	wfuzz -H "Host: FUZZ.target.domain" --hc 404,403 -c -z file,"/path/to/wordlist.txt" your_url
	```
- gobuster
	```
	gobuster vhost --wordlist "/path/to/wordlist.txt" --url your_url
	```

### Поиск подсетей

Онлайн-поиск:
```
https://securitytrails.com/domain/target.domain/history/a
https://viewdns.info/iphistory/?domain=target.domain
```

PTR-записи: 
```
dnsrecon -r 127.0.0.1/24 -d
amas intel -ip -addr 127.0.0.1.
amass intel -ip -src -cidr 127.0.0.1/24
amass intel -ip -src -asn 2025
```

Базы данных Forward DNS (FDNS)
```
crobat -r 127.0.0.1/24
amass intel -addr 127.0.0.1
amass intel -cidr 127.0.0.1/24
amsss intel -asn 2025
```

### Поиск сервисов

Утилиты:
- nmap (медленнее, но точнее)
	```
	nmap -Pn -p- --open -vv -T4 -iL subdomains.txt -oA nmap_results
	nmap -Pn -sV -p- --open -vv -iL subdomains.txt -oA nmap_results
	nmap -Pn -sV -p- --open -vv --version-all -iL subdomains.txt -oA nmap_results
	```
- masscan (быстрее, но менее точный)

Поиск веб-приложений
- httpx
- httprobe
```
httpx -ports
80,81,443,2053,2078,2079,2080,2083,2087,2090,2091,2096,2435,2942,5021,5353,5656,5357,5985,6092,6767,7080,7081,7088,7183,7419,7706,8008,8080,8081,8088,8172,8181,8401,8443,8880,8888,9001,9002,9003,9004,9419,9525,9998,15672,33034,47001,47279,52223,52227,52229,52231,52233 -l
subdomains.txt > http_subdomains.txt
```

Визуальное отображение веб-приложений

- [aquatone](https://github.com/michenriksen/aquatone)
- [WitnessMe](https://github.com/byt3bl33d3r/WitnessMe)
- [EyeWitness](https://github.com/RedSiege/EyeWitness)
```
cat http_subdomains.txt | aquatone
cat nmap.xml | aquatone -nmap
```

### Поиск директорий веб-приложений

- [gau](https://github.com/lc/gau)
- [waybackurls](https://github.com/tomnomnom/waybackurls)
```
cat domains.txt | waybackurls > urls.txt
cat domains.txt | gau -b ttf,woff,svg,png,jpg > urls.txt
```

Фаззинг (Fuzzing)
- gobuster
	```
	gobuster dir --wordlist "/path/to/wordlist.txt" --url your_url
	```
- ffuf
	```
	ffuf -w /path/to/wordlist -u https://target.domain/FUZZ
	ffuf -c -w "/path/to/wordlist.txt" -maxtime-job 60 -recursion -recursion-depth 2 -u your_url/FUZZ
	```
- dirsearch
- dirb
- dirbuster
- wfuzz
	```
	wfuzz --hc 404,403 -c -z file,"/path/to/wordlist.txt" your_url/FUZZ
	```
- feroxbuster
	```
	feroxbuster -w "/path/to/wordlist.txt" -u http://target.domain/
	```

**ВАЖНО! Фаззинг часто может вызвать отказ в обслуживании (DoS) из-за большого количества запросов в секунду (особенно ffuf и feroxbuster), поэтому скорость работы утилит нужно ограничивать**

Fuzzing Wordlists
- https://github.com/Bo0oM/fuzz.txt/blob/master/fuzz.txt
- https://wordlists.assetnote.io
- https://github.com/assetnote/wordlists
- https://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content
- https://github.com/random-robbie/bruteforce-lists

### Определение стека технологий

утилиты:
- [whatweb](https://github.com/urbanadventurer/whatweb) `whatweb https://terget.domain`
- [wappalyzer](https://www.wappalyzer.com/) - расширение
![[../Lect1/Materials/Pasted image 20250913103402.jpeg]]

Определение языка программирования по расширению файла
- .php, .php5, .phtml, ... -> php
- .aspx -> C#/VB.NET (ASP.NET)
- .asp -> VBScript (classic ASP)
- .isp, .jspx, .do -> Java
- .pl -> Perl
- .py -> Python (редко)
- .rb -> Ruby (редко)

### Прочие техники

##### Google Dorks
- <<>> - поиск вхождения
- -test - исключение страниц, содержащих "test"
- site:example.com - поиск только по доменам site.com
- inurl:keyword - поиск по кейвордам
- filetype:xls - поиск по расширениям
- и др

https://gist.github.com/sundowndev/283efaddbcf896ab405488330d1bbc06
https://www.exploit-db.com/google-hacking-database (Примеры)
Существуют подобные для других браузеров и Git

`site:\*.target.domain -www` -> поиск поддоменов, исключая уже найденные (www)

##### Cloud discovery
- [s3revon](https://github.com/clarketm/s3recon)
- [grayhatwarware](https://buckets.grayhatwarfare.com/)
```
s3recon "keywords-list.txt" -o "results.json" --public
https://buckets.grayhatwarfare.com/buckets/0/BUCKET_NAME
https://buckets.grayhatwarfare.com/results/FILE_NAME
```
На что еще обращаем внимание?
- Информация на странице (Секции Credits, contacts)
- нестандартные http заголовки
- файлы robots.txt, sitemap.xml, .DS_Strore, ...
- Комментарии и метаданные (HTML-, CSS-, JS-файлы)
- Логи ошибок (StackTrace)

##### Бонус: определение веб-сервера по стандартной ошибке 404
![[../Lect1/Materials/Pasted image 20250913104348.jpeg|649x630]]

