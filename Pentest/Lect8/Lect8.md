
Примеры (коммерция и торговля)
- использование негативных цен
- int overflow
- переиспользование скид купона
- Доверие цене, сообщ с клиентской стороны
- Нарушение правильной последовательности действий (подтверждение...)

Примеры (финансовый сектор)
- подтверждение нескольких переводов одним отп
- управление стоимостью ценных бумаг (резкое внесение большой суммы перед пересчётом и резкое снятие денег после)
- Проблема в конвертации валют

Примеры (Социальные сети)
- лайки
- влзможность просмаривания частных материалов

Примеры (игровая индустрия)
- манипуляция проверками времени
- Дублирование предметов
- Возможность получить игровые деньги дешевле их стоимости

Защита
- убедиться, что разработчики понимают домен приложения и осознают логику работы их приложения
- Избегать конкретных предположений о единственно правильном поведении пользователей и поведении составных частей приложения
Варианты достижения:
- Вести четкую документацию дизайна приложения и диаграммы потоков данных
- Отмечать предположение о поведении пользователей на каждом из этапов
- Писать чистый и понятный код
- Отмечать отсылки к другим частям кода. Обдумывать, возможны ли какие то последствия от использования данных зависимостей

# information disclosure

Ситуация, когда веб приложение непреднамеренно раскрывает конфиденциальную информацию своим пользователям. 
В зависимости от контекста, приложения могут раскрывать потенциальному злоумышленнику любую информацию, включая:
- Данные о других пользователях, например, имена пользователей или любую финансовую информацию
- Конфиденциальную ....

Примеры:
- раскрытие имет скрытых каталогов, структуры
- Представление доступа к файлам исходного кода через временные резервные копии
- Явное упоминание имён таблиц или столбцов базы данных в сообщениях об ошибках
- Необоснованное раскрытие конфидециальной информации, такой как данные кредитных карт
- Жестко закодированные API ключи, ip-адреса, учетные данные и т.д.
- Намеки на наличие или отсутствие ресурсов, имён пользователей и т.д. с помощью незначительных различий в поведении приложения

Способы поиска:
- фаззинг
- использование сканера (engagement tools)
- Ручное обнаружение

Некоторые источники
- файлы для веб-краулеров
- Листинг директорий
- комментарии разработчиков
- сообщения об ошибках
- дебаг-режими веб-приложений
- миссконфиг
- персональные страницы пользователей
- определение секции веб-приложений
- бекап файлы
- version control history

# 8 лекция. Серверные уязвимости веб приложений. Часть 5. Insecure deserialization, File Upload

## Insecure deserialization

сериализация - процесс преобразования сложных данных, таких как объекты и их поля, в более "плоский" формат, который можно отправлять и получать как последовательный поток байтов. Сериализация данных значительно упрощает:
- запись сложных данных в межпроцессорную память, файл или бд
- передачу сложных данных по сети между различными компонентами приложения или в вызове API
Важнейшим моментом является то, что при сериализации объекта его состояние также сохраняется. Другими словами, сохраняются атрибуты объекта и присвоенные им значения...

Вид сериализованных данны
- бинарный
- plaintext
корректный вид будет зависеть от языка программирования и библиотеки ...

Небезовасная десериализация - ситуация, когда веб-сайт десериализаует контролируемые пользователем данные. Это потенциально позволяет злоумышленнику манипулировать сериализнванными объектами для передачи вредоносных данных в код приложения

Влияние:
- контроль над функционалом, связанным с сериализованным объектом
- RCE
- повышение привелегий, чтение файлов, DoS
- разнообразное в зависимости от функционала

Детектирование

- при наличии исходного кода: библиотеки, функции и классы, специфичные для конкретных языков программирования
- при анализе черным ящиком: обращать внимание на сериализованные данные согласно форматам, специфичных для конкретных ЯП

Формат сериализации PHP

<картинка>

Формат сериализации Java
- Бинарный
- Способы детектирвования:
	- ...
Класс ja...

Сериализация .Net
- бинарный
- способы детектирования:
	- ...

.Net serialisation formatters

<картинка>

Прочие форматы сериализации:
py: pickle и производные (gASV в начале в base64)
Ruby: marshal
Node.js: node-serialize, serialize..., ...

Атаки на небезопасную десериализацию

1. Измена атрибута объекта
	- позволяет влиять на логику приложения
	- позволяет делать объединение с другими уязвимостями
2. Изменение типа данных
	- Позволяет влиять на логику приложения
	- Будет работать только в свободно типизированных ... Type Juggling (картинка)
3. Изменение атрибута объекта с последующим влиянием на его жизненный цикл
	- по сути тот же самый вектор, но ориентирован на жизненный цикл объекта
	- Пример: указание ссылки на внутренний файл в качестве атрибута объекта и последующие удаление пользователя...
	- также вектор может быть основан на вызове классических свойств объекта
Магические методы - особое подмножество методов, которые не требуют явного вызова. Вместо этого они вызываются автоматически при возникновении определённого события или сценария. Магические методы - распространённая особенность ООП в различных языках...

PHP methods...

как можно использовать магические методы:
- реализация логики при инъекции произвольного объекта
- построение цпочки гаджетов

gadget chain

гаджет - фрагмент собственного кода приложения (либо использования в зависимостях), позволяющий атакующему реализовать некоторую цель
- В одиночку гаджет редко представляет угрозу, однако, если использовать их каскадирование, то становится возможным достижение определённых мест
- При эксплуатации цепочки гаджетов не происходит инъекции нового кода - весь код уже в приложении. Атакующий контролирует только данные, которые предедаются в указанную им цепочку
- В реальных приложениях проэксплуатировать небезопасную десериализацию без построения цепочки гаджетов практически невозможно

Способы построения gadget chain

- использование предполготовленных цепочек гаджетов. Для многих фреймворков есть уже исследованные цепочки гаджетов. Существуют инструменты для этого
- Использования документированных цепочек гаджетов: поиск информации в открытых источниках об известных цепочках в выбранном фреймворке выбранного языка программирования
- Построение цепочки гаджетов вручную. Сложный, времязатратный, но эффективный процесс
- **Важно:** уязвимость небезопасной десериализации заключается в десериализации данных, подконтрольных пользователю, а не наличие цепочки гаджетов в приложении

PHAR десериализация
- PHP ARchive file - формат файла (архив)
- может быть вызван ...

Защита:
- **не использовать десериализацию пользовательского ввода**
- контроль целостности сериализованных данных
- по возможности не использовать универсальные методы для десериализации, а писать собственные для необходимых классов
- проверять тип данных после десериализации (может спасти от тайп джагглинг)
- ...



## File upload deserialozation

